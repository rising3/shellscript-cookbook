---
title: レシピ2-6 [[ ]]
---

import { Code } from '@astrojs/starlight/components';
import importedCode from '/samples/01/01_hello_world.sh?raw';

`[` コマンドでも条件式を書くことができるが、結合演算子や && や || を用いた複雑な条件式は可読性も低くなる。
そのような場合は、`[[ ]]` を使用すると && や || を用いて複雑な条件式も簡素に表現できる。
なお`[[ ]]` はbashの予約語になる。

`[[ ]]` は、`[` コマンドとほとんど同じ演算子が使用できる。

```bash
s1=abc
s2=xyz

# [[ ]]` は、`[` コマンドと同じ演算子が使用できる
if [[ "${s1}" != "${s2}" ]]; then
  真の場合の処理
if

# [[ ]] は、 &&(AND演算) や ||(OR演算) を使用できるが、[コマンドでは使用できない
if [[ "${s1}" != "${s2}" && "${s1}" = 'abc' ]]; then
  真の場合の処理
if
```

## `[[ ]]` と `[` コマンド の違い

`[` コマンドで書ける条件式は、ほとんど`[[ ]]` に置き換えることができるので、`[[ ]]` だけ使用しても問題はない。
ただし、`[[ ]]` の中では、単語分割とパス名展開が行われないため、変数のクォートの有無で `[` コマンドの実行と結果が変わる。

**単語展開による動作結果が異なる例1:**
```bash
s='abc xyz'
# 単語分割されるため、 abc xyz = abc と展開される
# 条件式の左辺に2つパラメータを指定したものとみなされ、この場合はエラーとなる
[ $s = abc ]; echo "$?"

# 単語分割されないため、 "abc xyz" = abc となる
# 左辺は1つのパラメータを指定したものとみなされる
[[ $s = abc ]]; echo "$?"

# 次のように変数をクォートするとどちらも同じ条件式になる
[ "$s" = abc ]; echo "$?";
[[ "$s" = abc ]]; echo "$?";
```

**単語展開による動作結果が異なる例2:**
```bash
s=
# (左辺なし) = abc と展開される
# 条件式の左辺が指定されていないとみなされ、この場合はエラーとなる
[ $s = abc ]; echo "$?"

# "" = abc となる
[[ $s = abc ]]; echo "$?"

# 次のように変数をクォートするとどちらも同じ条件式になる
[ "$s" = abc ]; echo "$?"
[[ "$s" = abc ]]; echo "$?"
```
bashでは、ダブルクォーテーション(`"`)でクォートすれば、その内側では単語分割が行われず、1つの単語とみなされる。
`[[ ]]` の中では、クォートされていなくても、単語分割は行われない。
`[[ ]]` に限った話ではないが、変数は常にダブルクォーテーション(`"`)でクォートすることを推奨する。

:::note[単語分割とパス名展開]
単語分割とは、パラメータ展開、コマンド置換、算術式典型を行った後の文字列をスペース、ダブ、改行によって複数の単語に区切る機能のこと。

パス名展開とは、 `*` や `?` のようなワイルドカード文字列の組み合わせとマッチするファイル名やディレクトリ名をすべて展開する機能のこと。
:::

## パターンマッチ

`[[ ]]` は、`[` コマンドでは使用できないパターンマッチを用いた条件式が使用できる。
